# 大戶投Demo開發計畫

## 核心需求

### 仿製大戶投 Web App (核心介面 + 動態數據)
- 模擬「大戶投」App的關鍵視覺介面和佈局
- 接入台灣市場相關新聞的外部API
- 接入台灣股市數據的外部API (至少包含個股報價，K線圖盡力而為)
- [x] 實現社群頁面本土化，包括中文姓名、台灣地點和亞洲圖片素材 (已完成，2024-07-30)
- [x] 增強社群頁面本土化內容，添加更多角色與台灣特色投資標籤 (已完成，2024-07-31)
- [x] 社群主頁(CopyTrader頁面)本地化，將英文名稱、內容改為中文 (已完成，2024-07-31)
- [x] 優化社群頁面導航與風格，移除多餘標籤並統一頁面配色風格 (已完成，2024-07-31)
- [x] 重構社群頁面導航系統，創建通用導航元件，並移除底部導航列 (已完成，2024-07-31)
- [x] 創建類股看板和豐神榜頁面，豐富社群功能 (已完成，2024-07-31)
- [x] 優化頁面返回按鈕，統一所有頁面的返回按鈕為「回大戶投」文字按鈕 (已完成，2024-07-31)
- [x] 確保所有頁面的返回按鈕直接導航回首頁/overview-page (已完成，2024-07-31)
- [x] 將項目推送到GitHub進行版本控制與協作開發 (已完成，2024-08-12)

### 智慧小豐 (RAG 問答)
- 提供可彈出的聊天視窗
- 使用RAG技術讀取預先準備的文件(如研究報告範例)
- 結合LLM模型生成回答用戶問題
- [x] 建立小型知識庫並在回答中顯示資訊來源引用 (已完成)
- [x] 優化知識庫實現方式，將知識庫和檢索從前端移至後端 (已完成，2025-05-12)
- [x] 添加問題前綴功能，使模型更清晰地識別用戶問題 (已完成，2025-05-12)
- [x] 新增「問小豐」按鈕於新聞詳情頁，實現新聞內容傳遞到智慧小豐的功能 (已完成，2024-07-30)

### LLM 內容摘要 (App 內整合)
- 在新聞、研究報告、財報等內容區塊提供「AI解讀」按鈕
- 後端調用LLM對該區塊內容進行摘要
- 將摘要結果顯示給使用者

## 前端
-前端目錄結構建立 (已完成)
- 頁面開發
  - 總覽頁 (OverviewPage)
    - 市場指數顯示
    - 交易資訊區塊更新 (已完成)
    - 熱門個股列表
    - 內容輪播與推廣區塊 (已完成)
    - 新增總覽頁內豐雲學堂/新聞7x24分頁點擊第一則新聞跳轉至靜態詳情頁功能 (已完成)
    - [x] 在總覽頁將「股票抽籤」圖標替換為「投資筆記」圖標 (已完成，2024-07-30)
  - 選股頁 (StockSelectPage)
    - 條件篩選介面
    - 篩選結果列表
    - 股票資訊動態顯示 (已完成)
  - 下單頁 (OrderEntryPage)
    - 模擬下單表單
    - 價格與量能顯示
  - 自選頁 (WatchlistPage)
    - 自選股列表
    - 個股基本資訊卡片
  - 帳務頁 (AccountPage)
    - 模擬持倉資訊
    - 損益統計
  - 新聞頁 (NewsFeedPage)
    - 新聞列表與分類
    - [x] 新聞詳情頁面增加「問小豐」和「存筆記」功能 (已完成，2024-07-30)
    - 新聞詳情與AI摘要功能
  - [x] 投資筆記頁 (NotesPage) (已完成，2024-07-30)
    - [x] 新增、編輯、刪除筆記功能 (已完成，2024-07-30)
    - [x] 從新聞詳情導入筆記 (已完成，2024-07-30)
    - [x] 通過 localStorage 存儲筆記 (已完成，2024-07-30)
    - [x] 支持標籤和搜索功能 (已完成，2024-07-30)
- 元件開發
  - 通用元件
    - 按鈕、卡片等UI基礎元件
    - [x] 統一各主要頁面區塊分隔線樣式 (已完成)
  - 布局元件
    - 頂部導航與底部菜單 
  - 特定功能元件
    - 智慧小豐彈出視窗
    - AI解讀按鈕與顯示區
    - 股市數據卡片
    - 新聞列表項目
    - [x] 優化市場指數頭部組件，解決多次重複API請求問題 (已完成)
    - [x] 優化智慧小豐常用字卡視覺效果，增加卡片與文字尺寸 (已完成)
    - [x] 新增豐雲學堂功能，提供市場話題、新手知識、選股策略等分類內容 (已完成)
    - [x] 調整豐雲學堂區塊UI，使其符合整體深色主題 (已完成)
    - [x] 實現智慧小豐接收新聞內容作為附件的功能 (已完成，2024-07-30)
    - [x] 實現投資筆記功能，支持從新聞詳情頁保存筆記 (已完成，2024-07-30)
    - [x] 整合筆記引用功能到智慧小豐界面，取代原有三個功能按鈕 (已完成，2024-07-30)
  - 圖表元件
    - K線圖顯示

## 後端
- 後端目錄結構建立
- API開發
  - 智慧小豐 API
    - RAG問答接口
    - 對話歷史管理
  - 摘要 API
    - 新聞摘要生成
    - 財報/研究報告摘要生成
  - 市場數據 API
    - 台股指數接口
    - 個股報價接口
    - K線數據接口
    - 新聞獲取接口
- 服務層開發
  - RAG 服務
    - 文檔存儲與檢索
    - 向量數據庫整合
  - 摘要服務
    - 內容提取與摘要邏輯
  - 台股數據服務
    - 外部API整合
    - 數據轉換與緩存
  - 新聞獲取服務
    - 新聞API整合
    - 內容清洗與格式化
  - LLM 接口
    - OpenAI API整合
    - 提示詞優化與管理

## 整合與測試
- 前後端整合
  - API交互測試
  - 數據流測試
- 自動化測試
  - 單元測試
  - 端到端測試
- 性能測試
  - 載入速度測試
  - API響應時間測試

## 部署
- [x] 容器化 (已完成，2025-01-27)
  - [x] Docker配置 (已完成，2025-01-27)
- [x] 環境配置 (已完成，2025-01-27)
  - [x] 環境變數管理 (已完成，2025-01-27)
  - [x] 安全配置修復 (已完成，2025-01-27)
- [x] 部署文檔 (已完成，2025-01-27)
  - [x] 多種部署方案指南 (已完成，2025-01-27)
- [ ] CI/CD 配置
  - [ ] 自動化部署流程
- [ ] 發布上線
  - [ ] 域名與SSL配置

# LLM 接入 
- 智慧小豐 (直接與 LLM 互動 - 後端)
  - [x] 建立 `backend/app/services/llm_interface.py` (已完成)
  - [x] 實作 `llm_interface.py` 與 Google Gemini API 對接 (使用 `gemini-pro`, `run_in_threadpool`)
  - [ ] 調整 `backend/app/services/rag_service.py` (暫更名為 `assistant_service.py` 或類似名稱) 以直接使用 `llm_interface.py` (移除 RAG 邏輯) (下一步)
  - [x] 建立 `backend/app/api/endpoints/assistant.py` (初步完成)
  - [ ] 建立 `backend/app/api/__init__.py` 與 `backend/app/api/endpoints/__init__.py` (初步完成)
  - [ ] 完善 `assistant.py` API 端點邏輯，使其呼叫新的 `assistant_service.py`
  - [ ] 將 assistant router 整合到 FastAPI 主應用
- RAG 功能 (暫緩)
  - [ ] (暫緩) 建立 `backend/data/` 目錄
  - [ ] (暫緩) 文件載入與預處理 (from `backend/data/`)
  - [ ] (暫緩) 整合 ChromaDB (嵌入、儲存、檢索)
  - [ ] (暫緩) LangChain 整合與 Prompt 工程
- LLM 內容摘要 (後端)
  - [ ] 建立 `backend/app/services/summarization_service.py`
  - [ ] 建立 `backend/app/api/endpoints/summary.py`
  - [ ] 實作摘要服務與 LLM 對接 (可複用 `llm_interface.py`)
  - [ ] 整合 summary router 到 FastAPI 主應用
- 智慧小豐 (前端)
  - [x] 實作聊天視窗介面
  - [x] 串接後端 `/assistant/query` API
- LLM 內容摘要 (前端)
  - [ ] 在相關頁面加入 "AI 解讀" 按鈕
  - [ ] 串接後端 `/summary` API 並顯示結果 

## 核心功能
- [x] Gemini API 整合至後端
- [x] 後端支援多輪對話 (基於記憶體 `conversation_histories`)
- [x] 前端傳遞 `user_id` 並從 `localStorage` 管理
- [x] 支援 Markdown 格式輸出

## 後端 (`backend`)
- [x] `/assistant/query` API 端點呼叫 Gemini (模型已由使用者更新為 `models/gemini-1.5-flash-preview-0514`)
- [x] `GenerativeModel` 初始化時傳入系統指令
- [x] `python-dotenv` 載入 `GEMINI_API_KEY`
- [x] `user_id` 管理對話歷史
- [x] `QuestionRequest` Pydantic 模型加入 `user_id`
- [x] `assistant_router` 正確註冊並加上 `/api` 前綴
- [x] `requirements.txt` 加入 `google-generativeai`, `python-dotenv`

## 前端 (`frontend`)
- [x] `handleSend`, `handleFlashcardClick` 呼叫 `/api/assistant/query`
- [x] 移除前端模擬 AI 回應
- [x] `user_id` 生成與 `localStorage` 存取
- [x] API 請求中附帶 `user_id`
- [x] `next.config.mjs` 設定 API 代理
- [x] **前端 Markdown 渲染**：在前端聊天訊息中渲染 Markdown 格式
- [x] **對話歷史功能**：實現對話歷史記錄、查看和恢復功能
- [x] **市場數據優化**：解決市場指數頭部組件多次重複API請求問題
- [x] **智慧小豐介面優化**：擴大常用字卡尺寸，新增豐雲學堂分類功能

## 待辦與優化
- [ ] **持久化儲存**：將對話歷史從記憶體移至 Redis 或資料庫
- [ ] **錯誤處理與日誌**：增強後端 API 的錯誤處理和日誌
- [ ] **前端 `user_id` 安全性**：評估並改進 `user_id` 管理方式
- [ ] **測試**：對多輪對話進行更全面的邊界測試 